<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (è¦–è¦ºç‰ˆ)</title>
    <style>
        /* CSS æ¨£å¼å€åŸŸ */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            padding: 20px;
            margin: 0;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d9004c;
            margin-bottom: 25px;
        }

        /* ------------------ Canvas è½‰ç›¤å€ ------------------ */
        #wheelCanvas {
            border: 3px solid #ccc;
            border-radius: 50%; /* ç¢ºä¿æ˜¯åœ“å½¢ */
            margin: 20px auto;
            display: block;
            background-color: #eee;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            touch-action: manipulation; /* é˜²æ­¢è§¸æ‘¸æ™‚é è¨­æ»¾å‹• */
        }
        .arrow {
            position: relative;
            margin: -60px auto 20px; /* å‘ä¸Šç§»å‹•åˆ°è½‰ç›¤ä¸Šæ–¹ */
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid #d9004c; /* ç´…è‰²ç®­é ­ */
            z-index: 10; /* ç¢ºä¿ç®­é ­åœ¨è½‰ç›¤ä¹‹ä¸Š */
        }
        
        /* ------------------ è¼¸å…¥å€ ------------------ */
        textarea {
            width: 95%;
            height: 100px; /* ç¨å¾®ç¸®å° */
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem;
        }
        .input-group {
            text-align: left;
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* ------------------ æŒ‰éˆ• ------------------ */
        #spin-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background-color: #1a73e8;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px #0f58b7;
        }
        #spin-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px #0f58b7;
        }
        #spin-btn:disabled {
            background-color: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* ------------------ çµæœå€ ------------------ */
        #result-display {
            margin-top: 25px;
            padding: 15px;
            min-height: 40px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #444;
            background-color: #f9f9f9;
        }
        .highlight-result {
            background-color: #d9004c;
            color: white;
            border-color: #d9004c;
            transition: all 0.5s ease-out;
            transform: scale(1.05);
        }
        
        /* å„²å­˜æç¤º */
        #save-status {
            margin-top: 10px;
            font-size: 0.8rem;
            color: green;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (è¦–è¦ºç‰ˆ) ğŸ¡</h1>

        <div class="arrow"></div>
        <canvas id="wheelCanvas" width="300" height="300"></canvas>

        <div id="result-display">
            è½‰å‹•è½‰ç›¤ï¼Œè®“å‘½é‹ç‚ºä½ æ±ºå®šï¼
        </div>

        <button id="spin-btn">é–‹å§‹è½‰å‹•ï¼</button>

        <div class="input-group">
            <label for="options-input">è«‹è¼¸å…¥ä½ çš„æ‰€æœ‰é¸é … (æ¯è¡Œä¸€å€‹é¸é …)ï¼š</label>
            <textarea id="options-input" placeholder="ä¾‹å¦‚ï¼š
ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»
(è«‹åˆªé™¤ç¯„ä¾‹ï¼Œè¼¸å…¥ä½ çš„é¸é …)">ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»</textarea>
            <div id="save-status">åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚</div>
        </div>
        
    </div>

    <script>
        // --- JavaScript é‚è¼¯å€åŸŸ ---

        const optionsInput = document.getElementById('options-input');
        const spinBtn = document.getElementById('spin-btn');
        const resultDisplay = document.getElementById('result-display');
        const saveStatus = document.getElementById('save-status');
        const wheelCanvas = document.getElementById('wheelCanvas');
        const ctx = wheelCanvas.getContext('2d');
        const STORAGE_KEY = 'fanSpinnerOptions';

        // è½‰ç›¤ç¹ªè£½åƒæ•¸
        const centerX = wheelCanvas.width / 2;
        const centerY = wheelCanvas.height / 2;
        const radius = Math.min(centerX, centerY) - 10; // ç•™é»é‚Šè·

        let currentRotation = 0; // ç•¶å‰è½‰ç›¤çš„æ—‹è½‰è§’åº¦ (å¼§åº¦)
        let isSpinning = false;
        let options = []; // å„²å­˜é¸é …çš„é™£åˆ—

        // é¡è‰²åº« (ç¢ºä¿æœ‰è¶³å¤ çš„é¡è‰²å¯ä»¥å¾ªç’°ä½¿ç”¨)
        const colors = ['#FFD1DC', '#FFC0CB', '#FFB6C1', '#FF69B4', '#DA70D6', '#BA55D3', '#9370DB', '#8A2BE2', '#4B0082', '#6A5ACD', '#483D8B', '#0000FF', '#0000CD', '#00008B', '#00BFFF', '#87CEEB', '#ADD8E6', '#B0E0E6', '#AFEEEE', '#00FFFF', '#E0FFFF', '#AFEEEE', '#00CED1', '#40E0D0', '#48D1CC', '#20B2AA', '#008B8B', '#008080', '#5F9EA0', '#8FBC8F', '#3CB371', '#2E8B57', '#006400', '#008000', '#228B22', '#32CD32', '#9ACD32', '#ADFF2F', '#7FFF00', '#7CFC00', '#6B8E23', '#556B2F', '#808000', '#BDB76B', '#DAA520', '#FFD700', '#FFA500', '#FF8C00', '#FF7F50', '#FF6347', '#FF4500', '#FF0000', '#DC143C', '#B22222', '#8B0000'];


        // --- 1. è³‡æ–™æŒä¹…åŒ– ---
        function loadOptions() {
            const savedOptions = localStorage.getItem(STORAGE_KEY);
            if (savedOptions) {
                optionsInput.value = savedOptions;
            }
            options = getCleanedOptions();
            drawWheel(); // è¼‰å…¥å¾Œç«‹å³ç¹ªè£½è½‰ç›¤
        }
        
        function saveOptions() {
            localStorage.setItem(STORAGE_KEY, optionsInput.value);
            saveStatus.textContent = 'åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚';
            saveStatus.style.opacity = 1;
            setTimeout(() => {
                saveStatus.style.opacity = 0;
            }, 1500);
            
            options = getCleanedOptions(); // é‡æ–°ç²å–é¸é …
            drawWheel(); // é‡æ–°ç¹ªè£½è½‰ç›¤
        }
        
        function getCleanedOptions() {
            return optionsInput.value
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        // --- 2. ç¹ªè£½è½‰ç›¤ ---
        function drawWheel() {
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height); // æ¸…ç©ºç•«å¸ƒ

            if (options.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('è«‹è¼¸å…¥é¸é …', centerX, centerY);
                return;
            }

            const arcAngle = (2 * Math.PI) / options.length; // æ¯å€‹æ‰‡å½¢çš„è§’åº¦

            for (let i = 0; i < options.length; i++) {
                const startAngle = i * arcAngle;
                const endAngle = (i + 1) * arcAngle;
                const segmentColor = colors[i % colors.length]; // å¾ªç’°ä½¿ç”¨é¡è‰²

                // ç¹ªè£½æ‰‡å½¢
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = segmentColor;
                ctx.fill();
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.stroke();

                // ç¹ªè£½æ–‡å­— (æ—‹è½‰å¾Œå†ç¹ªè£½)
                ctx.save(); // ä¿å­˜ç•¶å‰ç‹€æ…‹
                ctx.translate(centerX, centerY); // ç§»å‹•åŸé»åˆ°ä¸­å¿ƒ
                ctx.rotate(startAngle + arcAngle / 2 + Math.PI / 2); // æ—‹è½‰åˆ°æ‰‡å½¢ä¸­é–“ + 90åº¦è®“æ–‡å­—ç›´ç«‹
                ctx.textAlign = 'right'; // æ–‡å­—é å³å°é½Š (å¾ä¸­å¿ƒå¾€å¤–)
                ctx.fillStyle = (segmentColor === '#000000' || segmentColor === '#4B0082') ? '#fff' : '#333'; // æ ¹æ“šèƒŒæ™¯è‰²èª¿æ•´æ–‡å­—é¡è‰²
                ctx.font = '14px Arial';
                ctx.fillText(options[i], radius * 0.9, 0); // åœ¨åŠå¾‘çš„ 90% ä½ç½®ç¹ªè£½
                ctx.restore(); // æ¢å¾©ä¹‹å‰ä¿å­˜çš„ç‹€æ…‹
            }
            // ç¹ªè£½ä¸­å¿ƒåœ“
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.15, 0, 2 * Math.PI);
            ctx.fillStyle = '#fff';
            ctx.fill();
            ctx.strokeStyle = '#999';
            ctx.stroke();
        }

        // --- 3. è½‰ç›¤å‹•ç•«é‚è¼¯ ---
        function spinWheel() {
            options = getCleanedOptions();
            if (options.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹é¸é …ï¼");
                return;
            }
            if (isSpinning) return; // é¿å…é‡è¤‡é»æ“Š

            isSpinning = true;
            spinBtn.disabled = true;
            resultDisplay.classList.remove('highlight-result');
            resultDisplay.textContent = 'è½‰å‹•ä¸­...';

            const totalSpins = 3 + Math.random() * 2; // è‡³å°‘è½‰ 3-5 åœˆ
            const targetIndex = Math.floor(Math.random() * options.length); // æœ€çµ‚åœåœ¨å“ªå€‹é¸é …
            
            // è¨ˆç®—ç›®æ¨™è§’åº¦ (è®“ç®­é ­æŒ‡å‘ targetIndex çš„ä¸­é–“)
            // æ¯å€‹æ‰‡å½¢è§’åº¦ = arcAngle
            // ç›®æ¨™æ‰‡å½¢ä¸­å¿ƒé»è§’åº¦ = targetIndex * arcAngle + arcAngle / 2
            // ç”±æ–¼ç®­é ­åœ¨æ­£ä¸Šæ–¹ï¼Œè½‰ç›¤éœ€è½‰åˆ°è®“ç›®æ¨™æ‰‡å½¢ä¸­å¿ƒé»åœ¨ä¸‹æ–¹ (å³èˆ‡ç®­é ­å°é½Š)
            const arcAngle = (2 * Math.PI) / options.length;
            const targetAngleOffset = targetIndex * arcAngle + arcAngle / 2;
            const finalRotation = (totalSpins * 2 * Math.PI) + (2 * Math.PI - targetAngleOffset); // ç¢ºä¿è½‰åˆ°æ­£ç¢ºä½ç½®
            
            let startTime = null;
            const duration = 4000; // è½‰ç›¤å‹•ç•«æŒçºŒ 4 ç§’

            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1); // é€²åº¦ 0 åˆ° 1

                // ä½¿ç”¨ easeOutCubic ç·©å‹•å‡½æ•¸è®“è½‰ç›¤æ¸›é€Ÿ
                const easedProgress = 1 - Math.pow(1 - progress, 3); // (1 - (1-x)^3)
                
                // è¨ˆç®—ç•¶å‰æ—‹è½‰è§’åº¦
                currentRotation = easedProgress * finalRotation;

                ctx.save();
                ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                ctx.translate(centerX, centerY);
                ctx.rotate(currentRotation);
                ctx.translate(-centerX, -centerY);
                drawWheel(); // é‡æ–°ç¹ªè£½è½‰ç›¤ (å¸¶è‘—æ–°çš„æ—‹è½‰è§’åº¦)
                ctx.restore();

                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    // å‹•ç•«çµæŸ
                    isSpinning = false;
                    spinBtn.disabled = false;
                    resultDisplay.classList.add('highlight-result');
                    resultDisplay.textContent = `æ­å–œä½ ï¼çµæœæ˜¯ï¼šã€Œ${options[targetIndex]}ã€`;
                }
            }
            requestAnimationFrame(animateSpin);
        }

        // --- 4. äº‹ä»¶ç¶å®š ---
        spinBtn.addEventListener('click', spinWheel);
        optionsInput.addEventListener('input', saveOptions);
        
        // --- 5. åˆå§‹åŒ– ---
        loadOptions();
        
    </script>
</body>
</html>
