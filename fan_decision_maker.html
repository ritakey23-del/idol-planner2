<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (ä¸­å¿ƒæŒ‰éˆ•ç‰ˆ)</title>
    <style>
        /* CSS æ¨£å¼å€åŸŸ (ç•¥ï¼ŒåŒå‰ç‰ˆ) */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            padding: 20px;
            margin: 0;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d9004c;
            margin-bottom: 25px;
        }

        #wheelCanvas {
            border: 3px solid #ccc;
            border-radius: 50%;
            margin: 20px auto;
            display: block;
            background-color: #eee;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            /* é—œéµï¼šè¨­å®šæ¸¸æ¨™ç‚ºæŒ‡æ¨™ï¼Œæš—ç¤ºå¯é»æ“Š */
            cursor: pointer; 
            touch-action: manipulation;
        }
        
        #result-display {
            margin-top: 25px;
            padding: 30px 15px;
            min-height: 40px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #444; 
            background-color: #f9f9f9;
            transition: all 0.5s;
        }
        
        .highlight-result {
            background-color: #d9004c;
            color: #000000 !important; 
            border: 3px solid #d9004c;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(217, 0, 76, 0.4);
        }
        
        /* å¤–éƒ¨æŒ‰éˆ•å·²ç§»é™¤ */

        textarea {
            width: 95%;
            height: 100px;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (ä¸­å¿ƒæŒ‰éˆ•ç‰ˆ) ğŸ¡</h1>

        <canvas id="wheelCanvas" width="300" height="300"></canvas>

        <div id="result-display">
            é»æ“Šè½‰ç›¤ä¸­å¿ƒåœ“å½¢ï¼Œé–‹å§‹ä½ çš„æ±ºç­–ï¼
        </div>

        <div class="input-group">
            <label for="options-input">è«‹è¼¸å…¥ä½ çš„æ‰€æœ‰é¸é … (æ¯è¡Œä¸€å€‹é¸é …)ï¼š</label>
            <textarea id="options-input" placeholder="ä¾‹å¦‚ï¼š
ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»
(è«‹åˆªé™¤ç¯„ä¾‹ï¼Œè¼¸å…¥ä½ çš„é¸é …)">ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»</textarea>
            <div id="save-status">åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚</div>
        </div>
    </div>

   <script>
        // --- JavaScript é‚è¼¯å€åŸŸ ---

        const optionsInput = document.getElementById('options-input');
        const resultDisplay = document.getElementById('result-display');
        const saveStatus = document.getElementById('save-status');
        const wheelCanvas = document.getElementById('wheelCanvas');
        const ctx = wheelCanvas.getContext('2d');
        const STORAGE_KEY = 'fanSpinnerOptions';

        // è½‰ç›¤ç¹ªè£½åƒæ•¸
        const centerX = wheelCanvas.width / 2;
        const centerY = wheelCanvas.height / 2;
        const radius = Math.min(centerX, centerY) - 10;
        const colors = ['#FFD1DC', '#FFC0CB', '#FFB6C1', '#FF69B4', '#DA70D6', '#BA55D3', '#9370DB', '#8A2BE2', '#4B0082', '#6A5ACD', '#483D8B', '#0000FF', '#0000CD', '#00008B', '#00BFFF', '#87CEEB', '#ADD8E6', '#B0E0E6', '#AFEEEE', '#00FFFF', '#E0FFFF', '#AFEEEE', '#00CED1', '#40E0D0', '#48D1CC', '#20B2AA', '#008B8B', '#008080', '#5F9EA0', '#8FBC8F', '#3CB371', '#2E8B57', '#006400', '#008000', '#228B22', '#32CD32', '#9ACD32', '#ADFF2F', '#7FFF00', '#7CFC00', '#6B8E23', '#556B2F', '#808000', '#BDB76B', '#DAA520', '#FFD700', '#FFA500', '#FF8C00', '#FF7F50', '#FF6347', '#FF4500', '#FF0000', '#DC143C', '#B22222', '#8B0000'];


        let currentRotation = 0;
        let isSpinning = false;
        let options = [];

        // --- Helper: æ–‡å­—æ›è¡Œé‚è¼¯ (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function wrapText(ctx, text, maxWidth) {
            const words = text.split('');
            let line = '';
            let lines = [];
            for (let n = 0; n < words.length; n++) {
                const word = words[n];
                const testLine = line + word;
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && line.length > 0) {
                    lines.push(line);
                    line = word;
                } else {
                    line = testLine;
                }
            }
            lines.push(line);
            return lines;
        }

        // --- 1. è³‡æ–™æŒä¹…åŒ– (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function loadOptions() {
            const savedOptions = localStorage.getItem(STORAGE_KEY);
            if (savedOptions) {
                optionsInput.value = savedOptions;
            }
            options = getCleanedOptions();
            drawWheel();
            drawPointer();
        }
        
        function saveOptions() {
            localStorage.setItem(STORAGE_KEY, optionsInput.value);
            saveStatus.textContent = 'åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚';
            saveStatus.style.opacity = 1;
            setTimeout(() => {
                saveStatus.style.opacity = 0;
            }, 1500);
            
            options = getCleanedOptions();
            drawWheel();
            drawPointer();
        }
        
        function getCleanedOptions() {
            return optionsInput.value
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        // --- 2. ç¹ªè£½è½‰ç›¤ (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function drawWheel() {
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

            if (options.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('è«‹è¼¸å…¥é¸é …', centerX, centerY);
                return;
            }

            const arcAngle = (2 * Math.PI) / options.length;

            for (let i = 0; i < options.length; i++) {
                const startAngle = i * arcAngle;
                const endAngle = (i + 1) * arcAngle;
                const segmentColor = colors[i % colors.length];

                // ç¹ªè£½æ‰‡å½¢
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = segmentColor;
                ctx.fill();
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.stroke();

                // ç¹ªè£½æ–‡å­— 
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + arcAngle / 2); 
                
                ctx.textAlign = 'center'; 
                ctx.textBaseline = 'middle';
                
                const textColor = '#000000'; 
                ctx.fillStyle = textColor;
                ctx.font = 'bold 16px Arial'; 
                
                const maxWidth = radius * 0.7; 
                const lineHeight = 18; 
                const lines = wrapText(ctx, options[i], maxWidth);
                
                const totalTextHeight = lines.length * lineHeight;
                let textY = -totalTextHeight / 2 + lineHeight / 2;
                const textX = radius * 0.55; 
                
                for(let j = 0; j < lines.length; j++) {
                    ctx.fillText(lines[j], textX, textY);
                    textY += lineHeight;
                }
                
                ctx.restore();
            }
        }
        
        // --- 3. ç¹ªè£½ä¸­å¿ƒæŒ‡æ¨™ (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function drawPointer() {
            ctx.save();
            
            ctx.beginPath();
            ctx.strokeStyle = '#D9004C';
            ctx.lineWidth = 3;
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY - radius); 
            ctx.stroke();

            const centerRadius = radius * 0.15;
            ctx.beginPath();
            ctx.arc(centerX, centerY, centerRadius, 0, 2 * Math.PI);
            ctx.fillStyle = isSpinning ? '#CCCCCC' : '#D9004C'; 
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.stroke();
            
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(isSpinning ? 'GO!' : 'SPIN', centerX, centerY);
            
            ctx.restore();
        }

        // --- 4. é»æ“Šåµæ¸¬é‚è¼¯ (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function isClickInsideCenter(clickX, clickY) {
            const distance = Math.sqrt(Math.pow(clickX - centerX, 2) + Math.pow(clickY - centerY, 2));
            const centerRadius = radius * 0.15;
            return distance < centerRadius;
        }

        function handleCanvasClick(event) {
            const rect = wheelCanvas.getBoundingClientRect();
            const x = event.clientX - rect.left; 
            const y = event.clientY - rect.top;

            if (isClickInsideCenter(x, y) && !isSpinning && options.length > 0) {
                spinWheel();
            }
        }

        // --- 5. è½‰ç›¤å‹•ç•«é‚è¼¯ (æ ¸å¿ƒä¿®æ­£å€) ---
        function spinWheel() {
            options = getCleanedOptions();
            if (options.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹é¸é …ï¼");
                return;
            }
            if (isSpinning) return;

            isSpinning = true;
            resultDisplay.classList.remove('highlight-result');
            resultDisplay.classList.remove('spinning');
            resultDisplay.textContent = 'è½‰å‹•ä¸­...';

            const totalSpins = 5 + Math.random() * 2;
            const targetIndex = Math.floor(Math.random() * options.length); // é€™æ˜¯æœ€çµ‚è¦é¡¯ç¤ºçš„ç²å‹ Index
            
            const arcAngle = (2 * Math.PI) / options.length; 
            
            // è¦–è¦ºæ ¡æº–ä¿®æ­£é»ï¼šæˆ‘å€‘è¨ˆç®—æ—‹è½‰è§’åº¦æ™‚ï¼Œä½¿ç”¨ targetIndex å‰ä¸€å€‹ segment çš„ä¸­å¿ƒé»
            // é€™æ¨£åœ¨åœæ­¢æ™‚ï¼Œå¯ä»¥å°‡ç›®æ¨™ segment (targetIndex) æ¨å…¥ç®­é ­ä¸­å¿ƒ
            const angleIndex = (targetIndex - 1 + options.length) % options.length; 
            const targetAngleOffset = angleIndex * arcAngle + arcAngle / 2;
            
            const topPositionAngle = 3 * Math.PI / 2; // ç®­é ­åœ¨ 270åº¦
            
            // è¨ˆç®—å°‡å‰ä¸€å€‹ segment ä¸­å¿ƒé»è½‰åˆ° 270åº¦éœ€è¦çš„è§’åº¦
            let rotationToTarget = (topPositionAngle - targetAngleOffset) % (2 * Math.PI);
            if (rotationToTarget < 0) {
                rotationToTarget += 2 * Math.PI;
            }
            
            // ç¸½æ—‹è½‰è§’åº¦ = è‡³å°‘è½‰ N åœˆ + åœåœ¨ç›®æ¨™ä½ç½®çš„ç²¾ç¢ºè§’åº¦
            const finalRotation = (totalSpins * 2 * Math.PI) + rotationToTarget; 
            
            let startTime = null;
            const duration = 4000;

            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easedProgress = 1 - Math.pow(1 - progress, 3);
                
                currentRotation = easedProgress * finalRotation;

                ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                
                // æ—‹è½‰
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(currentRotation);
                ctx.translate(-centerX, -centerY);
                drawWheel();
                ctx.restore(); 

                // å›ºå®šç¹ªè£½
                drawPointer();
                
                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    // å‹•ç•«çµæŸ
                    isSpinning = false;
                    resultDisplay.classList.add('highlight-result');
                    resultDisplay.textContent = `æ­å–œä½ ï¼çµæœæ˜¯ï¼šã€Œ${options[targetIndex]}ã€`;
                    drawPointer(); // æœ€çµ‚é¡¯ç¤ºç‹€æ…‹
                }
            }
            resultDisplay.classList.add('spinning');
            requestAnimationFrame(animateSpin);
        }

        // --- 6. äº‹ä»¶ç¶å®šèˆ‡åˆå§‹åŒ– ---
        wheelCanvas.addEventListener('click', handleCanvasClick);
        optionsInput.addEventListener('input', saveOptions);
        
        loadOptions();
        
    </script>
