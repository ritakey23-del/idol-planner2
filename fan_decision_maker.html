<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (ä¿®æ­£æ–‡å­—ç‰ˆ)</title>
    <style>
        /* CSS æ¨£å¼å€åŸŸ (ç•¥ï¼Œå¤§éƒ¨åˆ†åŒå‰ç‰ˆ) */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            padding: 20px;
            margin: 0;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d9004c;
            margin-bottom: 25px;
        }

        #wheelCanvas {
            border: 3px solid #ccc;
            border-radius: 50%;
            margin: 20px auto;
            display: block;
            background-color: #eee;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
        }
        .arrow {
            position: relative;
            margin: -60px auto 20px; 
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid #d9004c;
            z-index: 10;
        }

        textarea {
            width: 95%;
            height: 100px;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem;
        }

        #spin-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            background-color: #1a73e8;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px #0f58b7;
        }
        #spin-btn:disabled {
            background-color: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        #result-display {
            margin-top: 25px;
            padding: 30px 15px;
            min-height: 40px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #444; /* é è¨­æ·±è‰²æ–‡å­— */
            background-color: #f9f9f9;
            transition: all 0.5s;
        }
        
        /* å‹•ç•«æ•ˆæœ (åŒå‰ç‰ˆ) */
        .spinning {
            border-style: solid;
            border-color: #d9004c;
            animation: pulse-spin 0.2s infinite alternate;
            color: #444 !important; /* ç¢ºä¿ç­‰å¾…æ™‚æ–‡å­—ä¹Ÿæ˜¯æ·±è‰² */
        }
        
        .highlight-result {
            background-color: #d9004c;
            color: white !important; /* ç¢ºä¿çµæœæ–‡å­—æ˜¯ç™½è‰²ï¼Œå°æ¯”å¼·çƒˆ */
            border: 3px solid #d9004c;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(217, 0, 76, 0.4);
        }

        @keyframes pulse-spin {
            0% { transform: scale(1); border-width: 3px; }
            100% { transform: scale(1.02); border-width: 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¡ è¿½æ˜Ÿæ±ºç­–è½‰ç›¤ (ä¸­å¿ƒæŒ‡æ¨™ç‰ˆ) ğŸ¡</h1>

        <canvas id="wheelCanvas" width="300" height="300"></canvas>

        <div id="result-display">
            é»æ“Šã€Œé–‹å§‹è½‰å‹•ã€ï¼Œè®“å‘½é‹ç‚ºä½ æ±ºå®šï¼
        </div>

        <button id="spin-btn">é–‹å§‹è½‰å‹•ï¼</button>

        <div class="input-group">
            <label for="options-input">è«‹è¼¸å…¥ä½ çš„æ‰€æœ‰é¸é … (æ¯è¡Œä¸€å€‹é¸é …)ï¼š</label>
            <textarea id="options-input" placeholder="ä¾‹å¦‚ï¼š
ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»
(è«‹åˆªé™¤ç¯„ä¾‹ï¼Œè¼¸å…¥ä½ çš„é¸é …)">ä»Šå¤©çœ‹èˆŠ MV
ä»Šå¤©çœ‹æ–° MV
ä»Šå¤©çœ‹èˆå°ç›´æ‹
ä»Šå¤©çœ‹ç¶œè—ç¯€ç›®
ä»Šå¤©å»è¿½æ˜Ÿæ™¯é»</textarea>
            <div id="save-status">åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚</div>
        </div>
    </div>

    <script>
        // --- JavaScript é‚è¼¯å€åŸŸ ---

        const optionsInput = document.getElementById('options-input');
        const spinBtn = document.getElementById('spin-btn');
        const resultDisplay = document.getElementById('result-display');
        const saveStatus = document.getElementById('save-status');
        const wheelCanvas = document.getElementById('wheelCanvas');
        const ctx = wheelCanvas.getContext('2d');
        const STORAGE_KEY = 'fanSpinnerOptions';

        // è½‰ç›¤ç¹ªè£½åƒæ•¸
        const centerX = wheelCanvas.width / 2;
        const centerY = wheelCanvas.height / 2;
        const radius = Math.min(centerX, centerY) - 10;
        const colors = ['#FFD1DC', '#FFC0CB', '#FFB6C1', '#FF69B4', '#DA70D6', '#BA55D3', '#9370DB', '#8A2BE2', '#4B0082', '#6A5ACD', '#483D8B', '#0000FF', '#0000CD', '#00008B', '#00BFFF', '#87CEEB', '#ADD8E6', '#B0E0E6', '#AFEEEE', '#00FFFF', '#E0FFFF', '#AFEEEE', '#00CED1', '#40E0D0', '#48D1CC', '#20B2AA', '#008B8B', '#008080', '#5F9EA0', '#8FBC8F', '#3CB371', '#2E8B57', '#006400', '#008000', '#228B22', '#32CD32', '#9ACD32', '#ADFF2F', '#7FFF00', '#7CFC00', '#6B8E23', '#556B2F', '#808000', '#BDB76B', '#DAA520', '#FFD700', '#FFA500', '#FF8C00', '#FF7F50', '#FF6347', '#FF4500', '#FF0000', '#DC143C', '#B22222', '#8B0000'];


        let currentRotation = 0;
        let isSpinning = false;
        let options = [];

        // --- 1. è³‡æ–™æŒä¹…åŒ– (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function loadOptions() {
            const savedOptions = localStorage.getItem(STORAGE_KEY);
            if (savedOptions) {
                optionsInput.value = savedOptions;
            }
            options = getCleanedOptions();
            drawWheel();
            drawPointer();
        }
        
        function saveOptions() {
            localStorage.setItem(STORAGE_KEY, optionsInput.value);
            saveStatus.textContent = 'åˆ—è¡¨å·²è‡ªå‹•å„²å­˜ã€‚';
            saveStatus.style.opacity = 1;
            setTimeout(() => {
                saveStatus.style.opacity = 0;
            }, 1500);
            
            options = getCleanedOptions();
            drawWheel();
            drawPointer();
        }
        
        function getCleanedOptions() {
            return optionsInput.value
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
        }

        // --- 2. ç¹ªè£½è½‰ç›¤ (æ ¸å¿ƒä¿®æ­£å€) ---
        function drawWheel() {
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

            if (options.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('è«‹è¼¸å…¥é¸é …', centerX, centerY);
                return;
            }

            const arcAngle = (2 * Math.PI) / options.length;

            for (let i = 0; i < options.length; i++) {
                const startAngle = i * arcAngle;
                const endAngle = (i + 1) * arcAngle;
                const segmentColor = colors[i % colors.length];

                // ç¹ªè£½æ‰‡å½¢
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = segmentColor;
                ctx.fill();
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.stroke();

                // ç¹ªè£½æ–‡å­— (æ ¸å¿ƒä¿®æ­£: å¢å¤§å­—é«”ä¸¦ç¢ºä¿é«˜å°æ¯”)
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + arcAngle / 2 + Math.PI / 2);
                ctx.textAlign = 'right';
                
                // ä¿®æ­£æ–‡å­—é¡è‰²é‚è¼¯: ç°¡å–®äº¤æ›¿é»‘ç™½ï¼Œä»¥ä¿è­‰é«˜å°æ¯”
                const textColor = (i % 2 === 0) ? '#000000' : '#FFFFFF'; 
                ctx.fillStyle = textColor;
                ctx.font = 'bold 16px Arial'; // å­—é«”å¢å¤§ä¸¦åŠ ç²—
                
                const displayText = options[i].length > 8 ? options[i].substring(0, 8) + '...' : options[i];
                ctx.fillText(displayText, radius * 0.9, 0);
                ctx.restore();
            }
        }
        
        // --- 3. ç¹ªè£½ä¸­å¿ƒæŒ‡æ¨™ (å›ºå®šï¼Œä¸æ—‹è½‰) ---
        function drawPointer() {
            ctx.save();
            
            // 1. ç¹ªè£½æŒ‡é‡ç·š (å¾ä¸­å¿ƒæŒ‡å‘ 12 é»é˜æ–¹å‘)
            ctx.beginPath();
            ctx.strokeStyle = '#D9004C';
            ctx.lineWidth = 3;
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY - radius); 
            ctx.stroke();

            // 2. ç¹ªè£½ä¸­å¿ƒåœ“ (å¼·èª¿æŒ‡ç¤ºé»)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.15, 0, 2 * Math.PI);
            ctx.fillStyle = '#D9004C';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.stroke();
            
            ctx.restore();
        }


        // --- 4. è½‰ç›¤å‹•ç•«é‚è¼¯ (ç•¥ï¼ŒåŒå‰ç‰ˆ) ---
        function spinWheel() {
            options = getCleanedOptions();
            if (options.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹é¸é …ï¼");
                return;
            }
            if (isSpinning) return;

            isSpinning = true;
            spinBtn.disabled = true;
            resultDisplay.classList.remove('highlight-result');
            resultDisplay.classList.remove('spinning');
            resultDisplay.textContent = 'è½‰å‹•ä¸­...';

            const totalSpins = 5 + Math.random() * 2;
            const targetIndex = Math.floor(Math.random() * options.length);
            
            const arcAngle = (2 * Math.PI) / options.length; 
            const targetAngleOffset = targetIndex * arcAngle + arcAngle / 2;
            
            const topPositionAngle = 3 * Math.PI / 2; 

            let rotationToTarget = (topPositionAngle - targetAngleOffset) % (2 * Math.PI);
            if (rotationToTarget < 0) {
                rotationToTarget += 2 * Math.PI;
            }
            
            const finalRotation = (totalSpins * 2 * Math.PI) + rotationToTarget; 
            
            let startTime = null;
            const duration = 4000;

            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easedProgress = 1 - Math.pow(1 - progress, 3);
                
                currentRotation = easedProgress * finalRotation;

                // ç¹ªè£½é †åºï¼šæ¸…ç©º -> æ—‹è½‰ç•«å¸ƒ -> ç¹ªè£½è½‰ç›¤ -> æ¢å¾©ç•«å¸ƒ -> ç¹ªè£½æŒ‡æ¨™
                ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                
                // 1. ç¹ªè£½æ—‹è½‰çš„è½‰ç›¤
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(currentRotation);
                ctx.translate(-centerX, -centerY);
                drawWheel();
                ctx.restore(); 

                // 2. ç¹ªè£½ä¸æ—‹è½‰çš„æŒ‡æ¨™ (å›ºå®šåœ¨ä¸­å¿ƒ)
                drawPointer();
                
                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    // å‹•ç•«çµæŸ
                    isSpinning = false;
                    spinBtn.disabled = false;
                    resultDisplay.classList.add('highlight-result');
                    resultDisplay.textContent = `æ­å–œä½ ï¼çµæœæ˜¯ï¼šã€Œ${options[targetIndex]}ã€`;
                }
            }
            resultDisplay.classList.add('spinning');
            requestAnimationFrame(animateSpin);
        }

        // --- 5. äº‹ä»¶ç¶å®š ---
        spinBtn.addEventListener('click', spinWheel);
        optionsInput.addEventListener('input', saveOptions);
        
        // --- 6. åˆå§‹åŒ– ---
        loadOptions();
        
    </script>
</body>
</html>
